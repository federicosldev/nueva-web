---

---

<!-- <section
    class="bg-lightpurple-pattern flex flex-col items-center justify-center text-center pt-16 md:pt-[100px] lg:pt-[160px] pb-20 md:pb-[150px] lg:pb-[200px]"
>
    <div class="w-full max-w-[1140px] px-4">
        <h2
            class="text-6xl md:text-5xl lg:text-7xl xl:text-9xl text-primary-purple uppercase"
        >
            Una vez que tenemos claros tus objetivos,
        </h2>
        <p
            class="text-2xl md:text-2xl lg:text-4xl xl:text-5xl text-primary-purple uppercase font-bold mt-6"
        >
            Podemos desarrollar una estrategia y un plan para alcanzarlos. Esto
            incluirá la identificación de los pasos necesarios, los recursos y
            los posibles obstáculos a superar.
        </p>
    </div>
</section> -->---
--- ---
<section
    class="physics-section bg-lightpurple-pattern flex flex-col items-center justify-center text-center pt-16 md:pt-[100px] lg:pt-[160px] pb-20 md:pb-[150px] lg:pb-[200px] relative overflow-hidden"
>
    <div class="physics-container absolute inset-0 z-0"></div>
    <div class="content relative z-10 w-full max-w-[1140px] px-4">
        <h2
            class="text-6xl md:text-5xl lg:text-7xl xl:text-9xl text-primary-purple uppercase"
        >
            Una vez que tenemos claros tus objetivos,
        </h2>
        <p
            class="text-2xl md:text-2xl lg:text-4xl xl:text-5xl text-primary-purple uppercase font-bold mt-6"
        >
            Podemos desarrollar una estrategia y un plan para alcanzarlos. Esto
            incluirá la identificación de los pasos necesarios, los recursos y
            los posibles obstáculos a superar.
        </p>
    </div>
</section>

<script>
    import Matter from 'matter-js';

    function initPhysics() {
        const Engine = Matter.Engine;
        const Render = Matter.Render;
        const World = Matter.World;
        const Bodies = Matter.Bodies;
        const Mouse = Matter.Mouse;
        const MouseConstraint = Matter.MouseConstraint;
        const Runner = Matter.Runner;

        const container = document.querySelector('.physics-container');
        if (!container) return;

        const updateContainerDimensions = () => {
            const section = container.closest('.physics-section');
            if (section) {
                container.style.height = `${section.clientHeight}px`;
                return {
                    width: container.clientWidth,
                    height: container.clientHeight,
                };
            }
            return null;
        };

        const dimensions = updateContainerDimensions();
        if (!dimensions) return;

        const isMobile = window.innerWidth < 768;
        const isTablet = window.innerWidth >= 768 && window.innerWidth < 1024;

        // Ajustar tamaños según el dispositivo
        const getItemDimensions = (baseWidth, baseHeight) => {
            if (isMobile) {
                return {
                    width: Math.floor(baseWidth * 0.7),
                    height: Math.floor(baseHeight * 0.7),
                };
            }
            if (isTablet) {
                return {
                    width: Math.floor(baseWidth * 0.85),
                    height: Math.floor(baseHeight * 0.85),
                };
            }
            return {
                width: baseWidth,
                height: baseHeight,
            };
        };

        const engine = Engine.create({
            gravity: { x: 0, y: 1, scale: 0.001 },
        });

        const render = Render.create({
            element: container,
            engine: engine,
            options: {
                width: dimensions.width,
                height: dimensions.height,
                wireframes: false,
                background: 'transparent',
                pixelRatio: window.devicePixelRatio,
            },
        });

        const runner = Runner.create();
        Runner.run(runner, engine);

        const baseItems = [
            { type: 'text', content: 'DESIGN', width: 150, height: 60 },
            {
                type: 'image',
                content:
                    'https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-iiWctC0jibsNzjYbGJvCcuH3UQacfC.png',
                width: 180,
                height: 60,
            },
            {
                type: 'text',
                content: 'USER EXPERIENCE',
                width: 220,
                height: 60,
            },
            { type: 'text', content: 'INSPIRATION', width: 190, height: 60 },
            { type: 'text', content: 'E-COMMERCE', width: 180, height: 60 },
            { type: 'text', content: 'MOTION GRAPHIC', width: 200, height: 60 },
            { type: 'text', content: 'WEB DESIGN', width: 190, height: 60 },
            { type: 'text', content: 'BRAND', width: 140, height: 60 },
            { type: 'text', content: 'USER INTERFACE', width: 210, height: 60 },
            { type: 'text', content: 'PROTOTYPING', width: 190, height: 60 },
            { type: 'text', content: 'TECHNOLOGY', width: 180, height: 60 },
        ];

        // Ajustar dimensiones de los items según el dispositivo
        const items = baseItems.map(item => {
            const { width, height } = getItemDimensions(
                item.width,
                item.height,
            );
            return { ...item, width, height };
        });

        const walls = [
            Bodies.rectangle(
                dimensions.width / 2,
                dimensions.height + 30,
                dimensions.width,
                60,
                {
                    isStatic: true,
                    friction: 0.8,
                    restitution: 0.2,
                    render: { fillStyle: 'transparent' },
                },
            ),
            Bodies.rectangle(0, dimensions.height / 2, 60, dimensions.height, {
                isStatic: true,
                friction: 0.8,
                restitution: 0.2,
                render: { fillStyle: 'transparent' },
            }),
            Bodies.rectangle(
                dimensions.width,
                dimensions.height / 2,
                60,
                dimensions.height,
                {
                    isStatic: true,
                    friction: 0.8,
                    restitution: 0.2,
                    render: { fillStyle: 'transparent' },
                },
            ),
        ];

        function createPillCanvas(item) {
            const scale = window.devicePixelRatio || 1;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');

            canvas.width = item.width * scale;
            canvas.height = item.height * scale;
            ctx.scale(scale, scale);

            ctx.fillStyle = '#fff';
            const radius = item.height / 2;
            ctx.beginPath();
            ctx.moveTo(radius, 0);
            ctx.lineTo(item.width - radius, 0);
            ctx.arcTo(item.width, 0, item.width, radius, radius);
            ctx.arcTo(
                item.width,
                item.height,
                item.width - radius,
                item.height,
                radius,
            );
            ctx.lineTo(radius, item.height);
            ctx.arcTo(0, item.height, 0, item.height - radius, radius);
            ctx.arcTo(0, 0, radius, 0, radius);
            ctx.closePath();
            ctx.fill();

            if (item.type === 'text') {
                ctx.fillStyle = '#6b46c1';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                // Ajustar tamaño de fuente según dispositivo
                const fontSize = isMobile ? 12 : isTablet ? 14 : 16;
                ctx.font = `bold ${fontSize}px Arial`;
                ctx.fillText(item.content, item.width / 2, item.height / 2);
            }

            return canvas;
        }

        const bodies = items.map(item => {
            const canvas = createPillCanvas(item);

            const commonProperties = {
                friction: 0.8,
                restitution: 0.2,
                density: 0.001,
                chamfer: { radius: isMobile ? 15 : 20 },
                render: {
                    sprite: {
                        texture: canvas.toDataURL(),
                        xScale: 1,
                        yScale: 1,
                    },
                },
            };

            const body = Bodies.rectangle(
                Math.random() * (dimensions.width - item.width) +
                    item.width / 2,
                dimensions.height - (isMobile ? 200 : 300),
                item.width,
                item.height,
                commonProperties,
            );

            if (item.type === 'image') {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.src = item.content;
                img.onload = () => {
                    const canvas = createPillCanvas(item);
                    const ctx = canvas.getContext('2d');
                    const scale = window.devicePixelRatio || 1;

                    const aspectRatio = img.width / img.height;
                    let drawWidth = item.width * 0.8 * scale;
                    let drawHeight = drawWidth / aspectRatio;

                    if (drawHeight > item.height * 0.8 * scale) {
                        drawHeight = item.height * 0.8 * scale;
                        drawWidth = drawHeight * aspectRatio;
                    }

                    const x = (item.width * scale - drawWidth) / 2;
                    const y = (item.height * scale - drawHeight) / 2;

                    ctx.drawImage(img, x, y, drawWidth, drawHeight);
                    body.render.sprite.texture = canvas.toDataURL();
                };
            }

            return body;
        });

        const mouse = Mouse.create(render.canvas);
        const mouseConstraint = MouseConstraint.create(engine, {
            mouse: mouse,
            constraint: {
                stiffness: 0.2,
                render: { visible: false },
            },
        });

        World.add(engine.world, [...walls, ...bodies, mouseConstraint]);
        Render.run(render);

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                const newDimensions = updateContainerDimensions();
                if (!newDimensions) return;

                render.canvas.width = newDimensions.width;
                render.canvas.height = newDimensions.height;
                render.options.width = newDimensions.width;
                render.options.height = newDimensions.height;

                Matter.Body.setPosition(
                    walls[0],
                    Matter.Vector.create(
                        newDimensions.width / 2,
                        newDimensions.height + 30,
                    ),
                );
                Matter.Body.setPosition(
                    walls[2],
                    Matter.Vector.create(
                        newDimensions.width,
                        newDimensions.height / 2,
                    ),
                );

                // Reiniciar la física cuando cambia el tamaño de la ventana
                World.clear(engine.world);
                Engine.clear(engine);
                initPhysics();
            }, 250);
        });
    }

    document.addEventListener('astro:page-load', initPhysics);
</script>

<style>
    .physics-section {
        min-height: 80vh;
        position: relative;
        overflow: hidden;
    }

    .physics-container {
        width: 100%;
        height: 100%;
        position: absolute;
        inset: 0;
    }

    .physics-container canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .content {
        position: relative;
        z-index: 10;
        text-align: center;
    }
</style>
